<!DOCTYPE html>
<html lang="pt">
 <head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
  <title>
   CornVault Integrado
  </title>
  <style>
   body { font-family: sans-serif; margin: 0; background: #fffef8; color: #1a1a1a; text-align: center; }
    .top { background: #2c6e49; color: white; padding: 20px; font-size: 24px; font-weight: bold; display:none; }
    .section { margin: 20px auto; max-width: 600px; background: #fff; border-radius: 10px; padding: 20px; box-shadow: 0 0 10px #ddd; display:none; }
    .btn { background: #2c6e49; color: white; border: none; padding: 10px 20px; margin: 10px; border-radius: 10px; cursor: pointer; }
    .nav { visibility: hidden; position:fixed; bottom:0; left:0; right:0; height:60px; background:#eee; display:flex; justify-content:space-around; align-items:center; border-top:1px solid #ccc; }
    .nav button { background:none; border:none; font-size:22px; }
  </style>
 </head>
 <body onload="startSplash()">
  <div id="splash" style="position:fixed;top:0;left:0;right:0;bottom:0;background:#fffef8;display:flex;flex-direction:column;align-items:center;justify-content:center;z-index:9999;">
   <div style="font-size:40px;font-weight:bold;">
    CornVault
   </div>
   <div style="font-size:60px;">
    🌽
   </div>
  </div>
  <div id="login" style="display:none;padding:30px;">
   <h2>
    Entrar no CornVault
   </h2>
   <input id="email" placeholder="Email" style="margin:10px;padding:10px;width:80%;"/>
   <br/>
   <input id="password" placeholder="Password" style="margin:10px;padding:10px;width:80%;" type="password"/>
   <br/>
   <button class="btn" onclick="login()">
    Entrar
   </button>
   <button class="btn" onclick="createAccount()">
    Criar Conta
   </button>
  </div>
  <div class="top" id="topBar" style="display:none;">
   CornVault
  </div>
  <div id="userInfo" style="margin: 10px; font-weight: bold;">
   Saldo:
   <span id="corns">
    20
   </span>
   CORNs
  </div>
  <div class="section" id="hub">
   <h3>
    Resumo Económico
   </h3>
   <canvas height="200" id="cornChart" width="300">
   </canvas>
   <p>
    <strong>
     Em circulação:
    </strong>
    1.233.456 CORNs
   </p>
   <p>
    <strong>
     Jogadores:
    </strong>
    128
   </p>
   <p>
    <strong>
     Teu nível:
    </strong>
    Agricultor Bronze
   </p>
  </div>
  <div class="section" id="field">
   <h3>
    🌽 Campo de Milhos
   </h3>
   <p>
    Milhos plantados: 🌽🌽🌽
   </p>
   <p>
    Rendimento estimado: €0.25 a cada 2 dias
   </p>
   <button class="btn" onclick="buyField()">
    Comprar Terreno (5 CORNs = 5€)
   </button>
  </div>
  <div class="section" id="pvp">
   <h3>
    ⚔️ Modo PVP
   </h3>
   <p>
    🦠 Atacar inimigo (5 CORNs): 49.99% sucesso
   </p>
   <p>
    🛡️ Comprar repelente (protege 3 ataques): 10 CORNs
   </p>
   <button class="btn" onclick="attack()">
    Atacar
   </button>
   <button class="btn" onclick="buyRepellent()">
    Comprar Repelente
   </button>
   <div id="pvpLog" style="margin-top:10px;">
   </div>
  </div>
  <div class="section" id="terms">
   <h3>
    📄 Termos e Condições
   </h3>
   <p>
    Simulação digital. Nenhuma transação real é efetuada nesta app.
   </p>
  </div>
  <div class="section" id="support">
   <h3>
    🛟 Suporte
   </h3>
   <p>
    Email: suporte@cornvault.com
   </p>
  </div>
  <div class="nav" id="navBar" style="visibility:hidden;">
   <button onclick="show('hub')">
    🏠
   </button>
   <button onclick="show('field')">
    🌾
   </button>
   <button onclick="show('pvp')">
    ⚔️
   </button>
   <button onclick="show('terms')">
    📄
   </button>
   <button onclick="show('support')">
    🛟
   </button>
  </div>
  <script>
   let userCorns = parseFloat(localStorage.getItem("corns")) || 100.0;
let hasField = false;
let cornHistory = [];
let cornInterval;
let historyInterval;
let pvpSpinning = false;

function updateCornsDisplay(animated = false, gain = 0) {
  const el = document.getElementById("corns");
  el.innerText = userCorns.toFixed(4);
  localStorage.setItem("corns", userCorns);

  if (animated && gain > 0) {
    const anim = document.createElement("span");
    anim.innerText = ` +${gain.toFixed(4)} CORNs`;
    anim.style.color = "green";
    anim.style.marginLeft = "10px";
    anim.style.fontWeight = "bold";
    el.parentElement.appendChild(anim);
    setTimeout(() => anim.remove(), 2000);
  }
}

function startEarnings() {
  if (!cornInterval) {
    cornInterval = setInterval(() => {
      if (hasField) {
        const gain = 0.003;
        userCorns += gain;
        updateCornsDisplay(true, gain);
      }
    }, 5000);
  }
}

function startHistoryLogging() {
  if (!historyInterval) {
    historyInterval = setInterval(() => {
      cornHistory.push({ time: new Date(), value: userCorns });
      if (cornHistory.length > 259200) cornHistory.shift(); // 15 dias de 5s logs
    }, 5000);
  }
}

function drawChart(range = 'minute') {
  const ctx = document.getElementById('cornChart').getContext('2d');
  let labels = [], data = [];

  let filtered = cornHistory.slice(-Math.min(180, cornHistory.length)); // padrão: últimos 15min

  if (range === 'day') {
    filtered = cornHistory.filter((_, i) => i % (60 * 12) === 0); // 1 log por hora
  }

  filtered.forEach(item => {
    labels.push(item.time.toLocaleTimeString());
    data.push(item.value.toFixed(4));
  });

  new Chart(ctx, {
    type: 'line',
    data: {
      labels,
      datasets: [{
        label: 'Saldo CORN',
        data,
        borderColor: '#2c6e49',
        fill: false,
        tension: 0.3
      }]
    },
    options: {
      responsive: true,
      plugins: { legend: { display: false }},
      scales: { y: { beginAtZero: true } }
    }
  });
}

function login() {
  const email = document.getElementById("email").value;
  const password = document.getElementById("password").value;
  if (localStorage.getItem("email") === email && localStorage.getItem("password") === password) {
    startApp();
  } else {
    alert("Credenciais inválidas.");
  }
}

function createAccount() {
  const email = document.getElementById("email").value;
  const password = document.getElementById("password").value;
  if (email && password) {
    localStorage.setItem("email", email);
    localStorage.setItem("password", password);
    localStorage.setItem("corns", "100.0");
    userCorns = 100.0;
    startApp();
  } else {
    alert("Preenche os dados.");
  }
}

function startApp() {
  document.getElementById("login").style.display = "none";
  document.getElementById("topBar").style.display = "block";
  document.getElementById("navBar").style.visibility = "visible";
  document.getElementById("navBar").style.display = "flex";
  updateCornsDisplay();
  startEarnings();
  startHistoryLogging();
  show("hub");
  drawChart();
}

function show(section) {
  document.querySelectorAll(".section").forEach(s => s.style.display = "none");
  document.getElementById(section).style.display = "block";
  if (section === 'hub') drawChart();
}

function buyField() {
  if (hasField) {
    alert("Já tens terreno.");
    return;
  }
  if (userCorns < 5) {
    alert("Não tens CORNs suficientes para comprar terreno!");
    return;
  }
  userCorns -= 5;
  hasField = true;
  alert("Terreno comprado! Começaste a gerar CORNs.");
  updateCornsDisplay();
}

function getRandomInternationalOpponent() {
  const names = ["Liam", "Emma", "Noah", "Olivia", "Ethan", "Ava", "Lucas", "Isabella", "Mason", "Mia"];
  return names[Math.floor(Math.random() * names.length)];
}

function attack() {
  if (pvpSpinning) return;
  if (userCorns < 5) {
    document.getElementById("pvpLog").innerText = "Não tens CORNs suficientes para atacar!";
    return;
  }

  pvpSpinning = true;
  const opponent = getRandomInternationalOpponent();
  userCorns -= 5;
  updateCornsDisplay();

  const pvpLog = document.getElementById("pvpLog");
  pvpLog.innerHTML = "A rodar resultado...";
  
  setTimeout(() => {
    const chance = Math.random();
    const success = chance < 0.4999;
    const msg = success
      ? `Vitória contra ${opponent}! +3 CORNs`
      : `Falhaste o ataque contra ${opponent}.`;
    if (success) userCorns += 3;
    updateCornsDisplay();
    pvpLog.innerHTML = `<div style="font-size:18px;">${msg}<br>Chance: ${(chance * 100).toFixed(2)}%</div>`;
    pvpSpinning = false;
  }, 2000);
}

function buyRepellent() {
  if (userCorns < 10) {
    document.getElementById("pvpLog").innerText = "Não tens CORNs suficientes para comprar repelente!";
    return;
  }
  userCorns -= 10;
  updateCornsDisplay();
  document.getElementById("pvpLog").innerText = "🛡️ Repelente comprado. Protege-te de 3 ataques.";
}

function startSplash() {
  setTimeout(() => {
    document.getElementById('splash').style.display = 'none';
    document.getElementById('login').style.display = 'block';
  }, 2000);
}
  </script>
 </body>
</html>
